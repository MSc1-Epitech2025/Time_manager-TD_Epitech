<div class="reports-page">
  <main class="main-content">
    <!-- Header -->
    <mat-card class="header-card" appearance="outlined">
      <mat-card-content>
        <div class="header-section">
          <div class="header-info">
            <h1 class="page-title">Reports</h1>
            <p class="page-subtitle">View and monitor system reports</p>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <div class="content-wrapper">
      <!-- Left side: Reports List -->
      <section class="reports-list-section">
        <!-- Search -->
        <mat-card class="search-card" appearance="outlined">
          <mat-card-content>
            <div class="search-section">
              <mat-form-field appearance="outline" class="search-field">
                <mat-label>Search reports</mat-label>
                <input matInput type="text" [(ngModel)]="searchTerm" (ngModelChange)="searchReports()"
                  placeholder="Title, content, or email..." />
                <mat-icon matPrefix>search</mat-icon>
              </mat-form-field>

              <button mat-raised-button class="refresh-btn" (click)="loadReports()">
                <mat-icon>refresh</mat-icon>
                <span>Refresh</span>
              </button>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Loading or error -->
        <mat-card *ngIf="isLoading || lastError" class="status-card" appearance="outlined">
          <mat-card-content>
            <div *ngIf="isLoading" class="loading-spinner">
              <mat-icon class="spin">refresh</mat-icon>
              <p>Loading reports...</p>
            </div>
            <div *ngIf="!isLoading && lastError" class="error-state">
              <mat-icon>error_outline</mat-icon>
              <p>{{ lastError }}</p>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Reports list -->
        <mat-card class="reports-list-card" appearance="outlined" *ngIf="!isLoading && !lastError">
          <mat-card-content class="reports-list-content">
            <div *ngIf="groupedReports.length > 0" class="reports-groups">
              <mat-accordion multi>
                <mat-expansion-panel *ngFor="let group of groupedReports" [expanded]="true" class="date-group">
                  <mat-expansion-panel-header>
                    <mat-panel-title class="group-title">
                      <mat-icon>calendar_today</mat-icon>
                      <span>{{ group.displayDate }}</span>
                      <span class="report-count">({{ group.reports.length }})</span>
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  
                  <mat-list class="reports-list">
                    <mat-list-item *ngFor="let report of group.reports; let last = last" class="report-item"
                      [class.selected]="selectedReport?.id === report.id" (click)="selectReport(report)">
                      <div matListItemTitle class="report-item-content">
                        <div class="report-header">
                          <div class="report-title">
                            <mat-chip [class]="'chip-' + getReportTypeChip(report.title)">
                              {{ report.title || 'Untitled' }}
                            </mat-chip>
                          </div>
                          <div class="report-date">{{ formatDate(report.createdAt) }}</div>
                        </div>
                        <div class="report-meta">
                          <div class="report-from">
                            <mat-icon>person</mat-icon>
                            <span>From: {{ report.authorEmail || 'Unknown' }}</span>
                          </div>
                          <div class="report-to">
                            <mat-icon>arrow_forward</mat-icon>
                            <span>To: {{ report.targetEmail || 'Unknown' }}</span>
                          </div>
                        </div>
                        <div class="report-body-preview" *ngIf="report.body">
                          {{ report.body.substring(0, 100) }}{{ report.body.length > 100 ? '...' : '' }}
                        </div>
                      </div>
                      <mat-divider *ngIf="!last"></mat-divider>
                    </mat-list-item>
                  </mat-list>
                </mat-expansion-panel>
              </mat-accordion>
            </div>

            <div *ngIf="groupedReports.length === 0" class="empty-state">
              <mat-icon>folder_off</mat-icon>
              <p>No reports to display</p>
            </div>
          </mat-card-content>
        </mat-card>
      </section>

      <!-- Right side: Report Details -->
      <section class="report-detail-section" *ngIf="selectedReport">
        <mat-card class="detail-card" appearance="outlined">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>description</mat-icon>
              Report Details
            </mat-card-title>
            <button mat-icon-button class="close-btn" (click)="selectedReport = null">
              <mat-icon>close</mat-icon>
            </button>
          </mat-card-header>
          <mat-card-content>
            <div class="detail-section">
              <div class="detail-row">
                <label>Title</label>
                <div class="detail-value">
                  <mat-chip [class]="'chip-' + getReportTypeChip(selectedReport.title)">
                    {{ selectedReport.title || 'Untitled' }}
                  </mat-chip>
                </div>
              </div>

              <div class="detail-row">
                <label>Created At</label>
                <div class="detail-value">{{ formatDate(selectedReport.createdAt) }}</div>
              </div>

              <div class="detail-row">
                <label>From</label>
                <div class="detail-value user-info">
                  <mat-icon>person</mat-icon>
                  <span>{{ selectedReport.authorEmail || 'Unknown' }}</span>
                </div>
              </div>

              <div class="detail-row">
                <label>To</label>
                <div class="detail-value user-info">
                  <mat-icon>person_outline</mat-icon>
                  <span>{{ selectedReport.targetEmail || 'Unknown' }}</span>
                </div>
              </div>

              <div class="detail-row full-width" *ngIf="selectedReport.body">
                <label>Content</label>
                <div class="detail-value content-box">
                  {{ selectedReport.body }}
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </section>
    </div>
  </main>
</div>

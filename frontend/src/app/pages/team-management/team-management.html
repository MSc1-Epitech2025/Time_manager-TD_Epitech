<div class="dashboard">
  <!-- ===== Main Content ===== -->
  <main class="main-content">
    <!-- Header -->
    <header class="header">
      <h2>Team Management</h2>
    </header>

    <!-- Search bar-->
    <section class="search-section">
      <div class="search-container">
        <mat-icon>search</mat-icon>
        <input
          type="text"
          class="search-bar"
          placeholder="Search for a team..."
          [(ngModel)]="searchTerm"
          (ngModelChange)="searchTeams()"
        />
      </div>

      <button class="search-btn" (click)="searchTeams()">
        <mat-icon>search</mat-icon>
        Search
      </button>
    </section>

    <section *ngIf="isLoading || lastError" class="status-section">
      <div *ngIf="isLoading">Loading teams...</div>
      <div *ngIf="!isLoading && lastError">{{ lastError }}</div>
    </section>

    <!-- === TEAM Section === -->
    <section class="team-grid" *ngIf="!isLoading && filteredTeams.length">
      <div class="team-card" *ngFor="let team of filteredTeams">
        <div class="team-header">
          <div class="team-avatar">
            {{ team.name.charAt(0).toUpperCase() }}
          </div>
          <div class="team-info">
            <button
              class="team-name-btn"
              (click)="viewTeamDetails(team)"
              (keydown.enter)="viewTeamDetails(team)"
              (keydown.space)="viewTeamDetails(team)"
            >
              {{ team.name }}
            </button>
            <p class="team-description">
              {{ team.description || 'No description' }}
            </p>
            <span>{{ team.members.length }} members</span>
          </div>
        </div>

        <div class="team-members">
          <div *ngIf="team.members.length === 0" class="no-members">
            No members
          </div>
          <div *ngFor="let member of team.members.slice(0, 5)" [title]="member.name" class="member-card">
            <img src="img/userProfil.png" [alt]="member.name[0]" class="member-avatar" />
            <p>{{ member.name }}</p>
          </div>
          <span *ngIf="team.members.length > 5" class="more-members">
            +{{ team.members.length - 5 }}
          </span>
        </div>

        <div class="team-actions">
          <button *ngIf="isAdminUser" (click)="openEditTeamModal(team)">
            <mat-icon>edit</mat-icon>
            Edit
          </button>
          <button *ngIf="isAdminUser" (click)="openDeleteTeamModal(team)">
            <mat-icon>delete</mat-icon>
            Delete
          </button>
        </div>
      </div>
    </section>

    <section *ngIf="isManagerUser && !isAdminUser" class="hint-section">
      <p>You can see the teams you are part of. Click on the team name to see details.</p>
    </section>

    <section *ngIf="isAdminUser" class="hint-section">
      <p>You can create, edit, or delete teams.</p>
    </section>

    <section *ngIf="!isLoading && !lastError && !filteredTeams.length" class="status-section">
      No teams to display.
    </section>

    <button
      matButton="filled"
      class="add-team-btn"
      *ngIf="isAdminUser"
      (click)="showAddModal()"
    >
      <mat-icon>add</mat-icon>
      Add a team
    </button>

  </main>
</div>

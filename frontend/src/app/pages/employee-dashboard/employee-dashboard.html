<div class="employee-dashboard">
  <main class="main-content">
    <header class="header">
      <div class="profile-section">
        <div class="profile-info">
          <h1 class="user-name">{{ user.name }}</h1>
          <p class="user-role">{{ user.poste || 'Position not set' }}</p>
          <span class="user-email">{{ user.email }}</span>
        </div>
        <img src="assets/profile-placeholder.png" alt="Profile" class="profile-img" />
      </div>
    </header>

    <section class="top-zone">
      <div class="work-status">
        <div class="status-info">
          <div class="status-badge" [class.active]="isWorking">
            <mat-icon>{{ isWorking ? 'schedule' : 'schedule' }}</mat-icon>
            <span>{{ isWorking ? 'Working' : 'Not Working' }}</span>
          </div>
          <p class="hours-today">
            <span class="label">Today:</span>
            <span class="value">{{ todayHoursMinutes.hours }}h {{ todayHoursMinutes.minutes }}m</span>
          </p>
        </div>
        <button
          class="btn-clock"
          [class.clock-in]="!isWorking"
          [class.clock-out]="isWorking"
          (click)="toggleWorkStatus()"
          [disabled]="actionPending">
          <mat-icon>{{ isWorking ? 'pause_circle_outline' : 'play_circle_outline' }}</mat-icon>
          <span>{{ isWorking ? 'Clock Out' : 'Clock In' }}</span>
        </button>
      </div>

      <div class="leave-balance-card">
        <h3>Leave Balance</h3>
        <div *ngIf="loadingLeaveBalance" class="loading-spinner">
          <mat-icon class="spin">refresh</mat-icon>
        </div>
        <div *ngIf="!loadingLeaveBalance && leaveAccounts.length === 0" class="empty-state-small">
          No leave data
        </div>
        <div *ngIf="!loadingLeaveBalance && leaveAccounts.length > 0" class="leave-list-horizontal">
          <div class="leave-item" *ngFor="let account of leaveAccounts">
            <span class="leave-type">{{ account.leaveType }}</span>
            <span class="leave-balance">{{ account.balance }} days</span>
          </div>
        </div>
      </div>
    </section>

    <section class="metrics-zone">
      <div class="card kpi-card">
        <h3>
          <mat-icon>insights</mat-icon>
          Weekly Statistics
        </h3>
        <div class="kpi-wrapper">
          <div class="kpi-container" *ngIf="!loadingKpi && kpiData; else loadingKpiTemplate">
            <div class="kpi-grid">
              <div class="kpi-item">
                <div class="kpi-label">Presence Rate</div>
                <div class="kpi-value">{{ kpiData.presenceRate | number:'1.1-1' }}%</div>
              </div>
              <div class="kpi-item">
                <div class="kpi-label">Avg Hours/Day</div>
                <div class="kpi-value">{{ kpiData.avgHoursPerDay | number:'1.1-1' }}h</div>
              </div>
              <div class="kpi-item">
                <div class="kpi-label">Overtime</div>
                <div class="kpi-value">{{ kpiData.overtimeHours | number:'1.1-1' }}h</div>
              </div>
              <div class="kpi-item">
                <div class="kpi-label">Late Rate</div>
                <div class="kpi-value">{{ kpiData.punctuality.lateRate | number:'1.1-1' }}%</div>
              </div>
              <div class="kpi-item">
                <div class="kpi-label">Avg Delay</div>
                <div class="kpi-value">{{ kpiData.punctuality.avgDelayMinutes | number:'1.0-0' }}min</div>
              </div>
              <div class="kpi-item">
                <div class="kpi-label">Absence Days</div>
                <div class="kpi-value">{{ kpiData.absenceDays | number:'1.1-1' }}</div>
              </div>
            </div>
          </div>
          <ng-template #loadingKpiTemplate>
            <div class="loading-spinner">
              <mat-icon class="spin">refresh</mat-icon>
              <p>Loading statistics...</p>
            </div>
          </ng-template>
        </div>
      </div>

      <div class="card absences-card">
        <div class="absences-header">
          <h3>
            <mat-icon>event_note</mat-icon>
            Recent Absences
          </h3>
          <div class="absences-actions">
            <button mat-raised-button class="action-btn-small absence" (click)="requestAbsence()">
              <mat-icon>event_busy</mat-icon>
              <span>Request Absence</span>
            </button>
            <button mat-raised-button class="action-btn-small planning" (click)="goToPlanning()">
              <mat-icon>calendar_month</mat-icon>
              <span>My Calendar</span>
            </button>
          </div>
        </div>
        <div *ngIf="loadingAbsences" class="loading-spinner">
          <mat-icon class="spin">refresh</mat-icon>
        </div>
        <div *ngIf="!loadingAbsences && recentAbsences.length === 0" class="empty-state">
          <mat-icon>check_circle</mat-icon>
          <p>No recent absences</p>
        </div>
        <div *ngIf="!loadingAbsences && recentAbsences.length > 0" class="absences-list">
          <div class="absence-item" *ngFor="let absence of recentAbsences">
            <div class="absence-header">
              <span class="absence-type">{{ formatAbsenceType(absence.type) }}</span>
              <span class="absence-status" [class]="absence.status.toLowerCase()">
                {{ absence.status }}
              </span>
            </div>
            <div class="absence-dates">
              {{ formatDate(absence.startDate) }} - {{ formatDate(absence.endDate) }}
            </div>
            <div class="absence-reason" *ngIf="absence.reason">
              {{ absence.reason }}
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>
